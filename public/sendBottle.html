<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/sendBottle.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <!-- VueJS -->
    <script src="https://unpkg.com/vue@next"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <title>Send bottle</title>
</head>

<body>
    <div id="app">
        <div class="container">
            <div class="row">
                <div class="col-md-6" id="write">
                    <form>
                        <div class="form-group">
                            <label for="exampleFormControlTextarea1">Type your message</label>
                            <div id="speechbutton" class="btn btn-success">speech recognition</div>
                            <div id="output"></div>
                            <textarea v-model="message" class="form-control" id="exampleFormControlTextarea1" rows="20"
                                maxlength="500"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="exampleFormControlFile1">Attach an image</label>
                            <input type="file" class="form-control-file" id="exampleFormControlFile1">
                        </div>
                        <div class="text-right">
                            <button type="button" class="btn btn-primary mb-2" onclick="generate(document.getElementById('exampleFormControlTextarea1').value)">Confirm</button>
                        </div>
                    </form>
                </div>
                <div class="col-md-6" id="text">
                    <p>{{message}}</p>
                    <p id="status"></p>
                </div>
            </div>
        </div>
    </div>
    </div>


    

    <script>

        myObject = new Vue({
            el: '#app',
            data: { message: 'Hello!' }
        })
        
    </script>

    <script src="js/speechRecognition/speech.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <!-- This is the API from Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>

    <script>
        // Config and Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDLM5eiv5cOkBtM-os59uGPAhtFkdBCAhY",
            authDomain: "sademo2018-2-11ec2.firebaseapp.com",
            databaseURL: "https://sademo2018-2-11ec2.firebaseio.com",
            projectId: "sademo2018-2-11ec2",
            storageBucket: "sademo2018-2-11ec2.appspot.com",
            messagingSenderId: "431393859582",
            appId: "1:431393859582:web:ccc0434dd68846b15b82af"
        };
        firebase.initializeApp(firebaseConfig);

        // writes the data to db
        if (localStorage.username != null){
            function generate(message) {
                var username = localStorage.username;
                console.log("updating" + username);
                var user = firebase.database().ref('users/' + username);
                user.once('value').then((snapshot) => {
                    if (snapshot.exists()) {
                        console.log("msg:" + message);
                        var updates = {};
                        updates['/users/' + username + "/" + 'bottle_message'] = message;
                        firebase.database().ref().update(updates);
                        document.getElementById("status").innerText = "User has been updated.";
                    } else {
                        document.getElementById("status").innerText = "User does not exist.";
                    }
                });
            }
        }
        else {
            window.location.href = 'login.html';
            alert("please login first!!");
        }


    </script>
    











    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</body>

</html>